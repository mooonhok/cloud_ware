<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
		<link rel="icon" href="head.ico" type="image/x-icon"/>
         <link rel="stylesheet" href="css/bootstrap.css">
         <link rel="stylesheet" href="css/index.css">
       	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script src="layer/layer.js"></script>
    <style>

	</style>
    </head>
    <body>
    	<div class="box">
    	<div class="kkk"></div>
    	<div class="box_1">

    <nav class="navbar navbar-default" role="navigation">
	<div class="container-fluid"> 
	<div class="navbar-header">
		<button type="button" class="navbar-toggle" data-toggle="collapse"
				data-target="#example-navbar-collapse">
			<span class="sr-only"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="#"><img src="images/tittle.png" alt=""></a>

	</div>

	<div class="collapse navbar-collapse" id="example-navbar-collapse">
		<ul class="nav navbar-nav" id="ull">
			<li><a href="yonhu.html">客户信息</a></li>
			<li><a href="zhuce.html">企业登记</a></li>
			<li><a href="" class="tc">退出登录</a></li>
		</ul>
		<div class="login">
			<div class="l1"><img src="images/login.png" alt=""></div>
			<div class="l2">登录</div>
		</div>
	</div>
	</div>
</nav>
	<div class="applica">
		<div class="applica_h">欢迎贵公司留下您的公司信息和联系方式，方便我们及时与你联系</div>
		<div class="srk"><img src="images/company.png"><input type="text" placeholder="公司名称" id="company"/></div>
		<div class="srk"><img src="images/name.png"><input type="text" placeholder="负责人名字" id="name"/></div>
		<div class="srk"><img src="images/telephone.png"><input type="text" placeholder="手机号" id="telephone"/></div>
		<div class="srk"><img src="images/address.png"><input type="text" placeholder="公司地址" id="address"/></div>
		<div id="hezuo">确认</div>
	</div>
	<div class="kb"></div>
	<div class="foot">
	<div class="foot_1">
		<div class="kb2"></div>
		<span class="f1">About Us</span>
		<p class="p10">关于我们</p>
		<div class="xian"></div>
		<div class="kb2"></div>
		<p class="p11">江苏酉铭科技有限公司</p>
		<p>移动电话:15365580443</p>
		<p>座机电话:0513-55880443</p>
	</div>	
	</div>
</div>
</div>
<div class="box2">
		<div class="box3">
			<div class="box3_1">
				<h4>业 务 员 登 录</h4>
			</div>
			<div class="qx">
				<img src="images/close.png" alt="">
			</div>	
			<div class="box3_2"></div>

			<div class="box3_3">
				<input type="text" id="username" placeholder="手机号">
			</div>	
			<div class="box3_4">
				<input type="password" id="password"  placeholder="密码">
			</div>	
			
			<div class="box3_8">
				<div class="box3_8_1"><input type="text" placeholder="请输入验证码" id="identify"></div>
				<div class="box3_8_2">
					<canvas id="canvas" width="120" height="35">		
					</canvas>
				</div>
			</div>
			<div class="box3_5" id="changeImg">
				看不清楚换一张
			</div>
			<div class="box3_6" id="signin">
				登 录
			</div>
		</div>
	</div>
    </body>
<script type="text/javascript" src="js/jquery.session.js"></script>
    <script type="text/javascript">
    var canvas;
	var context;
	var width;
	var height;
	var code="";	
	function randomNum(min,max){		
		return Math.floor(Math.random()*(max-min)+min);
	}
	function randomColor(min,max){
		var r = randomNum(min,max);
		var g = randomNum(min,max);
		var b = randomNum(min,max);
		return "rgb("+r+","+g+","+b+")";
	}
	//生成随机数
	function randomCode(){
		var code1 = "";
		var str = 'ABCEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789';
		for(var i = 0;i<4;i++){
			var txt = str[randomNum(0,str.length)];
			context.font = "20px simHei";
			context.fillStyle = randomColor(35,120);
			var x = 10+i*25;
			var y = randomNum(25,30);
			var deg = randomNum(-15,15);
			context.rotate(deg*Math.PI/180);
			context.fillText(txt,x,y);
			context.rotate(-deg*Math.PI/180);
			code1 +=txt;
			code = code1;
		}
		 console.log(code1);
	}	
	function randomArc(){

		for(var i = 0;i<=100;i++){
		context.fillStyle = randomColor(0,255);
		context.beginPath();
		context.arc(randomNum(0,width),randomNum(0,height), 1, 0, 2*Math.PI);
		context.fill();
		}
	}
	function randomLine(){
		for (var i = 0; i < 8 ; i++) {
			context.strokeStyle = randomColor(50,160);
			context.beginPath();
			context.moveTo(randomNum(0,width),randomNum(0,height));
			context.lineTo(randomNum(0,width),randomNum(0,height));
			context.stroke();
		}
	}
	function draw(){
		canvas = document.getElementById('canvas');
		context = canvas.getContext('2d');
		width = canvas.width;
		height = canvas.height;
		context.fillStyle =randomColor(150,220);
	    context.fillRect(0,0,width,height);
		randomCode();
		randomArc();
		randomLine();
	}	
	draw();
  document.getElementById("changeImg").onclick = function(e){
    e.preventDefault();
    draw();
  }	
    </script>
    <script type="text/javascript">
    	$(".login").on("click",function(){
    		$(".box2").css("display","block");
    	})
    	$(".qx").on("click",function(){
			$(".box2").css("display","none");
		})
    </script>
    <script type="text/javascript">
    	var tel=$.session.get('user');
		//alert(tel);
		if(tel!=null&&tel!=""){
			alert("用户已经登录");
			$(".login").css("display","none");
			$("#ull").css("display","block");
		}else{
    	$("#signin").on('click',function(){
			var name=$("#username").val();
			var pwd=$("#password").val();
			var input = document.getElementById('identify').value;
			if(!/^1[34578]\d{9}$/.test(name)){
				alert("手机号码格式不对");
			}else if(input.length<=3||input.toUpperCase() != code.toUpperCase()){
				alert("验证码错误")
			}else{
			$.ajax({
   		  	  url:"http://api.uminfo.cn/sales.php/usersign",
   		  	  dataType:'json',
   		  	  type:'post',
   		  	  ContentType:"application/json;charset=utf-8",
   		  	  data:JSON.stringify({
   		  	       username:name,
   		  	       password:pwd
   		  	  }),
   		  	  success:function(msg){
   		  	  	if(msg.result==0){
   		  	  	    $.session.set('userid',msg.user.id);
   		  	  	    $.session.set('user',msg.user.telephone);
   		  	  	    var user=$.session.get('userid');
   		  	  		alert("登录成功"); 
   		  	  	    $(".login").css("display","none");
			        $("#ull").css("display","block");
			        $(".box2").css("display","none");			
   		  	  	}else{
   		  	  		alert(msg.desc);
   		  	  	} 
   		  	  },
   		  	  error:function(xhr) {
   		  	  	alert(xhr.responseText);
   		  	  }
		});
		}
		});
		}                                                                                                                                                                        
		$(".tc").on('click',function(){
			$.session.remove('userid');
			$.session.remove('user');
			window.location.reload();
		});	
		$("#con2").on("click",function(){
			$("#image").attr('src','images/erweima1.png');
		})
		$("#con3").on("click",function(){
			$("#image2").attr('src','images/erweima1.png');
		})
    </script>
    	<script language=javascript>
       $(function(){

       	$("#hezuo").on("click",function(){
       	var company=$("#company").val();
       	var name=$("#name").val();
       	var telephone=$("#telephone").val();
       	var address=$("#address").val();
       	if(company.length<=0){
       		layer.msg('公司名字不能为空');
       	}else if(name.length<=0){
       		layer.msg('负责人名字不能为空');
       	}else if(!/^1[34578]\d{9}$/.test(telephone)){
       		layer.msg('手机号有误');
       	}else if(address.length<=0){
       		layer.msg('公司地址不能为空');
       	}else{
       	$.ajax({
   		  	  url:"http://api.uminfo.cn/contactCompany.php/addCompany",
   		  	  dataType:'json',
   		  	  type:'post',
   		  	  contentType:"application/json;charset=utf-8",
   		  	  data:JSON.stringify({
   		  	       company:company,
   		  	       contact_name:name,
   		  	       telephone:telephone,
   		  	       address:address
   		  	  }),
   		  	  success:function(msg){
   		  	  //	alert(msg.result);
   		  	  	if(msg.result==0){	
                   layer.msg('感谢您的信任，我们会尽快与您取得联系', {time:2000}); 
                   window.location.reload();
   		  	  	}else{
   		  	  		layer.msg(msg.desc);
   		  	  	}
   		  	  },
   		  	  error:function(xhr) {
   		  	  	alert(xhr.responseText);
   		  	  }
		});
		}
       	});
       	});
    </script>
</html>
