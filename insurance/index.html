<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/safe.css">
		<link rel="stylesheet" href="src/css/layui.css">
		<title>保险</title>
		<style>
			table {
				border-right: 1px solid #9CBA60;
				border-bottom: 1px solid #9CBA60;
			}
			
			table td {
				border-left: 1px solid #9CBA60;
				border-top: 1px solid #9CBA60;
				height: 50px;
				text-align: center;
			}
			
			table thead tr th {
				height: 50px;
				line-height: 50px;
				text-align: center;
				border-left: 1px solid #9CBA60;
				border-top: 1px solid #9CBA60;
				background: #9CBA60;
			}
			
			a {
				text-decoration: none;
			}
			
			button {
				width: 100px;
				height: 30px;
				background: #FF8903;
				border: 0;
				border-radius: 5px;
				color: white;
			}
		</style>
	</head>
	<body>
		<div class="box">
			<div class="top">
				<div class="top_1">
					<img src="images/1.jpg" alt="">
				</div>
				<div class="top_2">
					<img src="images/2.jpg" alt="">
				</div>
			</div>
			<div class="top_3"></div>
			<div class="select">
				<div class="select_1">
					<select name="province" id="province1" onchange="getPro1()" class="pro">
						<option value="0">请选择省</option>
					</select>
					<select name="city" id="city1" class="cit">
						<option value="0">请选择市</option>
					</select>
					<button class="hunt">选择搜索</button>
				</div>
				<div class="select_2">
					<div class="select_2_1"><input id="coname" type="text"></div>
					<div class="select_2_2"><img src="images/seek.png" alt="" width="30" height="30"></div>
				</div>
			</div>
			<div class="gps">
				<div class="gps_1">支付信息</div>
				<div class="gps_2" style="background: green;color: white;">历史保单</div>
			</div>
			<!-- 历史保单 -->
			<div class="tab_1">
				<table id="tables" width="1200" border="0" cellspacing="0" cellpadding="0">
					<thead>
						<tr>
							<th>投保人</th>
							<th>投保人联系电话</th>
							<th>车牌</th>
							<th>驾驶员</th>
							<th>发站</th>
							<th>到站</th>
							<th>货物详情</th>
							<th>投保金额</th>
							<th>保费</th>
							<th>保险开始时间</th>
							<th>运输时间</th>	
						</tr>
					</thead>
					<tbody id="tb2">
						<tr>
							<td>lll</td>
							<td>aaa</td>
							<td>sss</td>
							<td>xxxx</td>
							<td>zzzz</td>
							<td>cccc</td>
							<td>dddd</td>
							<td>vvv</td>
							<td>qqq</td>
							<td>www</td>
							<td>eee</td>
						</tr>
					</tbody>
				</table>
				<div id="demo2"></div>
				<div class="box2">
					<div class="box2_1">
						货物详情
					</div>
					<div class="box2_2">
						取消
					</div>
				</div>

			</div>


		</div>
	</body>
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/jquery.session.js"></script>
<script type="text/javascript" src="src/layui.js"></script>
<script type="text/javascript">

</script>
<script type="text/javascript">
	function insurance(city_id,company){
	      	if(city_id==null){
				city_id="";
			}
		if(company==null){
				company="";
			}
	$.ajax({
		url:"http://mooonhok-cloudware.daoapp.io/rechange_insurance.php/insurances?city_id=" + city_id + "&company=" + company+"&page=1"+"&per_page=2",
		dataType:'json',
		type:'get',
		contentType: "application/json;charset=utf-8",
		data: JSON.stringify({}),
		success:function(msg){
	        $("#tb2").html("");
			console.log(msg);
			console.log(msg.rechange_insurance.length);
			for(var i=0;i<msg.rechange_insurance.length;i++){
				var a = '<tr><td>'+msg.rechange_insurance[i].company+'</td><td>'
				+msg.rechange_insurance[i].customer_phone+'</td><td>'
				+msg.rechange_insurance[i].plate_number+'</td><td>'
				+msg.rechange_insurance[i].driver_name+'</td><td>'
				+msg.rechange_insurance[i].receive_city+'</td><td>'
				+msg.rechange_insurance[i].from_city+'</td><td class="det" onclick="detil('
				+msg.rechange_insurance[i].insurance_id+')">详情</td><td>'
				+msg.rechange_insurance[i].insurance_price+'</td><td>'
				+msg.rechange_insurance[i].insurance_amount+'</td><td>'
				+msg.rechange_insurance[i].insurance_start_time+'</td><td>'
				+msg.rechange_insurance[i].duration+'</td></tr>';
				$("#tb2").append(a);
			}
			layui.use(['laypage', 'layer'], function(){
             var laypage = layui.laypage
            ,layer = layui.layer;
	         laypage.render({
             elem: 'demo2'
             ,count:'7'
             ,theme: '#1E9FFF'
             ,pages:msg.rechange_insurance.desc
  });
})
		},error:function(xhr){
			alert("获取保险记录后台失败！");
		}
	});
}
	function detil(id){
		//alert(id);
   	      	$.ajax({
   	      	   url: "http://mooonhok-cloudware.daoapp.io/rechange_insurance.php/one_goods?insurance_id=" + id,
				dataType: 'json',
				type: 'get',
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({}),
				success: function(msg) {
					// alert(msg.goods);
					$(".box2").css("display","block");
				},
				error: function(e) {
					alert("获取货物详情出错!");
				}
   	      	});
	}



	</script>

<script>
		(function($) {
			$.getUrlParam = function(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if(r != null) return decodeURI(r[2]);
				return null;
			}
		})(jQuery);
		//获取省份和城市列表1
		$.ajax({
			url: "http://mooonhok-cloudware.daoapp.io/city.php/province",
			beforeSend: function(request) {
				request.setRequestHeader("tenant-id", "Chenxizhang");
			},
			dataType: 'json',
			type: 'get',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify({}),
			success: function(msg) {
				for(var i = 0; i < msg.province.length; i++) {
					$("#province1").append('<option value="' + msg.province[i].id + '">' + msg.province[i].name + '</option>');
				}
			},
			error: function(e) {
				alert("省份列表1信息出错!");
			}
		});

		function getPro1() {
			$("#city1").empty();
			var pid = $("#province1 option:selected").val();
			$.ajax({
				url: "http://mooonhok-cloudware.daoapp.io/city.php/city?pid=" + pid,
				beforeSend: function(request) {
					request.setRequestHeader("tenant-id", "Chenxizhang");
				},
				dataType: 'json',
				type: 'get',
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({}),
				success: function(msg) {
					for(var i = 0; i < msg.city.length; i++) {
						$("#city1").append('<option value="' + msg.city[i].id + '">' + msg.city[i].name + '</option>');
					}
				},
				error: function(e) {
					alert("城市1列表信息出错!");
				}
			});
		}
	</script>
<script>
		//选择搜索按钮的事件
		$(".hunt").on('click', function() {
			city_id = $("#city1 option:selected").val();
			window.location.href="http://mooonhok-cloudware.daoapp.io/insurance/safe.html?city_id=" + city_id+"&company=";
			//loadrechanges(city_id, company);
			//insurance(city_id,company);
		})
		//搜索框
		$(".select_2_2").on('click', function() {
			company = $("#coname").val();
			city_id = $("#city1 option:selected").val();
			if(city_id==null||city_id==""){
				alert("请先选择城市");
			}else{
				window.location.href="http://mooonhok-cloudware.daoapp.io/insurance/safe.html?city_id=" + city_id+"&company="+company;
				//alert(company);
			//loadrechanges(city_id, company);
			//insurance(city_id,company);
			}

		});

	</script>


<script>
	
//	     var city_id = $.getUrlParam('city_id');
//		 var company = $.getUrlParam('company');
	   var city_id=null;
	   var company=null;
		//获取session值
		var user = $.session.get('userid');
		//alert(user);
		if(user == null || user == "") {
			window.location.href = "login.html";
		}else{
			insurance(city_id,company);
		}
	
		$(".det").on("click",function(){
			$(".box2").css("display","block");
		})
		$(".gps_1").on("click",function(){
			window.location.href="safe.html";
		})
		
		$(".box2_2").on("click", function() {
			$(".box2").css("display", "none");
		})

   	$(".quxiao").on("click",function(){
   		$(".bigbox").css("display","none");
   	})
   </script>
</html>