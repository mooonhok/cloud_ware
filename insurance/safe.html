<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/safe.css">
		
		<title>保险</title>
		<style>
			table {
				border-right: 1px solid #9CBA60;
				border-bottom: 1px solid #9CBA60;
			}
			
			table td {
				border-left: 1px solid #9CBA60;
				border-top: 1px solid #9CBA60;
				height: 50px;
				text-align: center;
			}
			
			table thead tr th {
				height: 50px;
				line-height: 50px;
				text-align: center;
				border-left: 1px solid #9CBA60;
				border-top: 1px solid #9CBA60;
				background: #9CBA60;
			}
			
			a {
				text-decoration: none;
			}
			
			button {
				width: 100px;
				height: 30px;
				background: #FF8903;
				border: 0;
				border-radius: 5px;
				color: white;
			}
		</style>
	</head>

	<body>
		<div class="box">
			<div class="top">
				<div class="top_1">
					<img src="images/1.jpg" alt="">
				</div>
				<div class="top_2">
					<img src="images/2.jpg" alt="">
				</div>
			</div>
			<div class="top_3"></div>
			<div class="select">
				<div class="select_1">
					<select name="province" id="province1" onchange="getPro1()" class="pro">
						<option value="0">请选择省</option>
					</select>
					<select name="city" id="city1" class="cit">
						<option value="0">请选择市</option>
					</select>
					<button class="hunt">选择搜索</button>
				</div>
				<div class="select_2">
					<div class="select_2_1"><input type="text"></div>
					<div class="select_2_2"><img src="images/seek.png" alt="" width="30" height="30"></div>
				</div>
			</div>
			<div class="gps">
				<div class="gps_1">支付信息</div>
				<div class="gps_2">历史保单</div>
			</div>
			<!-- 支付信息 -->
			<div class="tab">
				<table  width="1200" border="0" cellspacing="0" cellpadding="0">
					<thead>
						<tr>
							<th width="350">公司名</th>
							<th width="200">时间</th>
							<th width="150">保费</th>
							<th width="300">合同详情</th>
							<th width="200">操作</th>
						</tr>
					</thead>
					<tbody id="tb1">
						<!--<tr>
					<td>一号物流公司</td>
					<td>2017-11-16</td>
					<td>11.00</td>
					<td><a href="">详情</a></td>
					<td><button class="but">确认支付</button></td>
				</tr>
				-->
					</tbody>
				</table>
				<div class="box3">
					<div class="box3_1">
						<input id="makesure" type="hidden"></input>
						<!--	<p><span>xxx</span>已支付:<span>xxx</span>元保费</p>-->
					</div>
					<div class="box3_2">
						确认
					</div>
					<div class="box3_3">
						取消
					</div>
				</div>
			</div>

			<!-- 历史保单 -->
			<div class="tab_1">
				<table width="1200" border="0" cellspacing="0" cellpadding="0">
					<thead>
						<tr>
							<th width="150">车牌号</th>
							<th width="150">驾驶员</th>
							<th width="200">电话</th>
							<th width="150">货物详情</th>
							<th width="150">投保金额</th>
							<th width="150">保费</th>
							<th width="250">运输时间</th>
						</tr>
					</thead>

					<tbody>

					</tbody>
				</table>
				<div class="box2">
					<div class="box2_1">
						货物详情
					</div>
					<div class="box2_2">
						取消
					</div>
				</div>
			</div>
		</div>

	</body>
<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/jquery.session.js"></script>
	<script>
		//获取省份和城市列表1
		$.ajax({
			url: "http://mooonhok-cloudware.daoapp.io/city.php/province",
			beforeSend: function(request) {
				request.setRequestHeader("tenant-id", "Chenxizhang");
			},
			dataType: 'json',
			type: 'get',
			contentType: "application/json;charset=utf-8",
			data: JSON.stringify({}),
			success: function(msg) {
				for(var i = 0; i < msg.province.length; i++) {
					$("#province1").append('<option value="' + msg.province[i].id + '">' + msg.province[i].name + '</option>');
				}
			},
			error: function(e) {
				alert("省份列表1信息出错!");
			}
		});

		function getPro1() {
			$("#city1").empty();
			var pid = $("#province1 option:selected").val();
			$.ajax({
				url: "http://mooonhok-cloudware.daoapp.io/city.php/city?pid=" + pid,
				beforeSend: function(request) {
					request.setRequestHeader("tenant-id", "Chenxizhang");
				},
				dataType: 'json',
				type: 'get',
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({}),
				success: function(msg) {
					for(var i = 0; i < msg.city.length; i++) {
						$("#city1").append('<option value="' + msg.city[i].id + '">' + msg.city[i].name + '</option>');
					}
				},
				error: function(e) {
					alert("城市1列表信息出错!");
				}
			});
		}
	</script>

	<script>
		//加载保险充值记录
		function loadrechanges(city_id, company) {
			if(city_id==null){
				city_id="";
			}
			if(company==null){
				company="";
			}
			$.ajax({
				url: "http://mooonhok-cloudware.daoapp.io/rechange_insurance.php/insurance_rechanges?city_id=" + city_id + "&company=" + company,
				dataType: 'json',
				type: 'get',
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({}),
				success: function(msg) {
					$("#tb1").html("");
					//alert(msg.insurance_rechanges);
					if(msg.insurance_rechanges == null || msg.insurance_rechanges == "") {
						alert("尚未有冲值记录");
					} else {
						for(var i = 0; i < msg.insurance_rechanges.length; i++) {
							var sure = null;
							if(msg.insurance_rechanges[i].status == 0) {
								sure = "确认支付";
							} else {
								sure = "已经支付";
							}
							a = "<tr><td>" + msg.insurance_rechanges[i].company + "</td><td>" +
								msg.insurance_rechanges[i].pay_time + "</td><td>" +
								msg.insurance_rechanges[i].money + "</td><td><a href=''>详情</a></td><td><button class='but' onclick='makesure(" +
								msg.insurance_rechanges[i].id + ")'>" +
								sure + "</button></td></tr>";
							 if(msg.insurance_rechanges[i].status == 1) {
								$('.but').attr("disabled", "disabled");
							}
							$("#tb1").append(a);
						}
					}
				},
				error: function(xhr) {
					alert("获取后台失败！");
				}
			});
		}
		
		function makesure(id){
				$(".box3").css("display", "block");
				alert(id);
				$("#makesure").val(id);			
		}
		
		var city_id = null;
		var company = null;
		//获取session值
		var user = $.session.get('userid');
		alert(user);
		if(user == null || user == "") {
			window.location.href = "login.html";
		} else {
			loadrechanges(city_id, company);
		}
	</script>
	<script type="text/javascript">
		$(".box3_3").on("click", function() {
			$(".box3").css("display", "none");
		})

		$(".gps_2").on("click", function() {
			$(".tab_1").css("display", "block");
			$(".tab").css("display", "none");
			$(".gps_2").css("background", "blue")
			$(".gps_1").css("background", "white")
		})
		$(".gps_1").on("click", function() {
			$(".tab_1").css("display", "none");
			$(".tab").css("display", "block");
			$(".gps_2").css("background", "white")
			$(".gps_1").css("background", "blue")
		})
		$(".box2_2").on("click", function() {
			$(".box2").css("display", "none");
		})
	</script>
	<script>
		//选择搜索按钮的事件
		$(".hunt").on('click', function() {
			city_id = $("#city1 option:selected").val();
			loadrechanges(city_id, company);
		})
		$(".select_2_2").on('click', function() {
			company = $(".select_2_1").html();
			loadrechanges(city_id, company);
		});
		
	</script>
	<script>
		//确认支付
		$(".box3_2").on("click", function() {
			var id = $("#makesure").val();
			alert(id);
			$.ajax({
				url: "http://mooonhok-cloudware.daoapp.io/rechange_insurance.php/sure_rechanges",
				beforeSend: function(request) {
					request.setRequestHeader("tenant-id", "Chenxizhang");
				},
				dataType: 'json',
				type: 'put',
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({
					id: id,
					user_id: user
				}),
				success: function(msg) {
					city_id = $("#city1 option:selected").val();
					company = $(".select_2_1").html();
					alert("修改成功");
					$(".box3").css("display", "none");
					loadrechanges(city_id, company);
				},
				error: function(e) {
					alert("修改支付状态后台错误");
				}
			});
			//		
			//			$(".but").html("已支付");
			//			$('.but').attr("disabled", "disabled");
		});
	</script>

</html>